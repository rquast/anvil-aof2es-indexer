# Anvil Connect ElasticSearch Indexer

## Description

The purpose of this daemon is to read and tail append only files (Redis AOF mode) generated by Anvil Connect, and send user, role and scope information to ElasticSearch. This gives you the ability to search on the metadata of users, roles, clients and scopes, which is not (currently) provided by the rest/v1 routes in Anvil Connect.

## Configuring ElasticSearch

The following changes must be made to elasticsearch.yml:

### Change the cluster name

```
cluster.name: anvilConnect
```

### Turn on dynamic scripting

```
script.inline: true
script.indexed: true
```

### Disable multicast discovery if running locally

```
discovery.zen.ping.multicast: false
```

## Running

Obtain the latest [jar binary](https://github.com/cavyio/anvil-aof2es-indexer/blob/todoinsertlinkhere), or compile with Maven.

```
mvn clean package
```

Run for the first time..

```
java -jar aof2es-0.0.1-SNAPSHOT.jar
```

This will create an ~/.aof2es directory with preferences.json and indexer.log files.

If your AOF file is not located in /var/lib/redis/appendonly.aof, edit the preferences file and re-run.
